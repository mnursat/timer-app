<div class="container">
  <!-- Mode Toggle -->
  <div class="mode-toggle">
    <button [class.active]="mode() === 'stopwatch'" (click)="mode.set('stopwatch')">
      ‚è±Ô∏è –°–µ–∫—É–Ω–¥–æ–º–µ—Ä
    </button>
    <button [class.active]="mode() === 'timer'" (click)="mode.set('timer')">
      ‚è≤Ô∏è –¢–∞–π–º–µ—Ä
    </button>
    <button [class.active]="mode() === 'clock'" (click)="mode.set('clock')">
      üìÖ –î–µ–Ω—å –Ω–µ–¥–µ–ª–∏
    </button>
  </div>

  <!-- Stopwatch Mode -->
  @if (mode() === 'stopwatch') {
  <div class="display-card stopwatch">
    <div class="time-display">
      <div class="time-main">
        {{formattedStopwatch().hours}}:{{ formattedStopwatch().minutes }}:{{ formattedStopwatch().seconds }}:{{ formattedStopwatch().milliseconds }}
      </div>
    </div>

    <div class="controls">
      <button class="btn-primary" [class.btn-pause]="stopwatchRunning()" (click)="toggleStopwatchRunning()">
        {{ stopwatchRunning() ? '‚è∏ –ü–∞—É–∑–∞' : '‚ñ∂ –°—Ç–∞—Ä—Ç' }}
      </button>
      <button class="btn-secondary" (click)="resetStopwatch()">
        ‚Üª –°–±—Ä–æ—Å
      </button>
    </div>

    <!-- Lap times with new @for syntax -->
    @if (lapTimes().length > 0) {
    <div class="laps">
      <h3>–ö—Ä—É–≥–∏ ({{ lapTimes().length }}):</h3>
      @for (lap of lapTimes(); track $index) {
      <div class="lap-item">
        <span class="lap-number">‚Ññ{{ lapTimes().length - $index }}</span>
        <span class="lap-time">{{ lap.minutes }}:{{ lap.seconds }}.{{ lap.milliseconds }}</span>
        <button class="lap-delete-btn" (click)="deleteLap($index)" title="–£–¥–∞–ª–∏—Ç—å –∫—Ä—É–≥">
          <img src="/assets/icons/delete.png" alt="delete" width="16" height="16">
        </button>
      </div>
      } @empty {
      <p class="empty-message">–ù–µ—Ç –∫—Ä—É–≥–æ–≤</p>
      }
    </div>
    }

    @if (stopwatchRunning()) {
    <button class="btn-lap" (click)="recordLap()">
      üèÅ –ó–∞–ø–∏—Å–∞—Ç—å –∫—Ä—É–≥
    </button>
    }
  </div>
  }

  <!-- Timer Mode -->
  @if (mode() === 'timer') {
    <div class="display-card">
      @if (timerRemaining() === 0 && !timerRunning()) {
        <div class="timer-setup">
          <label>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä–µ–º—è</label>
          <div class="time-inputs">
            <div class="input-group">
              <input type="number" [ngModel]="timerMinutes()" (ngModelChange)="setTimerMinutes($event)" min="0" max="59" placeholder="–ú–ú">
              <span>–ú–∏–Ω—É—Ç—ã</span>
            </div>
            <div class="input-group">
              <input type="number" [ngModel]="timerSeconds()" (ngModelChange)="timerSeconds.set($event)" min="0" max="59" placeholder="–°–°">
              <span>–°–µ–∫—É–Ω–¥—ã</span>
            </div>
          </div>
        </div>

        <!-- Quick Timer Presets -->
        <div class="quick-timers">
          <p>–ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞:</p>
          <div class="preset-buttons">
            @for (preset of timerPresets; track preset.value) {
              <button class="btn-preset" (click)="setTimerPreset(preset.minutes, preset.seconds)">
                {{ preset.label }}
              </button>
            }
          </div>
        </div>
      } @else {
        <div class="time-display">
          <div class="time-main" [class.timer-complete]="timerComplete()">
            {{ formattedTimer().minutes }}:{{ formattedTimer().seconds }}:{{ formattedTimer().milliseconds }}
          </div>
        </div>
        @if (timerComplete()) {
          <div class="timer-alert">‚è∞ –í—Ä–µ–º—è –≤—ã—à–ª–æ!</div>
        }
      }
      <!-- Progress Bar: always visible in timer mode -->
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="timerProgress()"></div>
      </div>
      <div class="controls">
        @if (!timerRunning() && timerRemaining() === 0) {
          <button class="btn-primary" [disabled]="timerMinutes() === 0 && timerSeconds() === 0" (click)="startTimer()">‚ñ∂ –°—Ç–∞—Ä—Ç</button>
        } @else {
          <button class="btn-primary" [class.btn-pause]="timerRunning()" (click)="toggleTimerRunning()">{{ timerRunning() ? '‚è∏ –ü–∞—É–∑–∞' : '‚ñ∂ –°—Ç–∞—Ä—Ç' }}</button>
          <button class="btn-secondary" (click)="resetTimer()">‚Üª –°–±—Ä–æ—Å</button>
        }
      </div>
    </div>
  }
  
  <!-- Clock / Day Mode -->
  @if (mode() === 'clock') {
    <div class="display-card">
      <div class="time-display">
        <div class="time-main">{{ userDayName() }}</div>
        <div class="time-ms" style="font-size:20px; margin-top:8px;">{{ currentDateString() }}</div>
      </div>
      <div style="margin-top:20px;">
        <label style="display:block; text-align:center; margin-bottom:8px;">–£–∑–Ω–∞—Ç—å –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ –ø–æ –¥–∞—Ç–µ</label>
        <div style="display:flex; gap:8px; justify-content:center; align-items:center;">
          <div class="date-input">
            <input type="text" [ngModel]="userDateInput()" (ngModelChange)="setUserDate($event)" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 12 —Å–µ–Ω—Ç—è–±—Ä—è 2009" aria-label="–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É" />
            @if (userDateInput()) {
              <button class="date-clear" (click)="setUserDate('')" aria-label="–û—á–∏—Å—Ç–∏—Ç—å">‚úñ</button>
            }
          </div>
        </div>
        <div style="text-align:center; margin-top:12px;">
          @if (userDateError()) {
            <div style="color:#e53e3e; font-weight:600; font-size: small;">{{ userDateError() }}</div>
          }
        </div>
      </div>
    </div>
   }
 </div>